# 🤖 自动踢人功能使用说明

## 功能介绍

自动检测并踢出未经邀请的 ChatGPT Team 成员,保护你的团队安全。

## 工作原理

1. **定期检测**: 按照设定的时间间隔,自动检查所有 Team 的成员列表
2. **对比验证**: 将当前成员与数据库中的邀请记录进行对比
3. **自动踢出**: 发现非法成员(未在邀请列表中)立即踢出
4. **记录日志**: 所有踢人操作都会记录到数据库,可在后台查看

## 配置说明

### 1. 启用/禁用

- ✅ **启用**: 勾选"启用自动检测踢人"复选框
- ❌ **禁用**: 取消勾选即可停止自动检测

### 2. 检测间隔

- **最小值**: 建议 90 秒
- **最大值**: 建议 120 秒
- **说明**: 系统会在这个范围内随机选择间隔时间,避免被检测为机器人

**⚠️ 重要提示:**
- 不建议低于 30 秒,可能被 ChatGPT 官方检测为滥用
- 建议设置为 90-120 秒,既能及时发现非法成员,又不会触发限流

### 3. 运行时间

- **开始时间**: 例如 09:00
- **结束时间**: 例如 22:00
- **时区**: 北京时间 (Asia/Shanghai)

**说明**: 只在设定的时间段内运行检测,其他时间自动暂停,模拟人类作息

## 使用步骤

### 步骤 1: 配置参数

1. 登录管理员后台: `http://你的域名:5002/admin`
2. 找到"🤖 自动踢人配置"卡片
3. 设置参数:
   - ✅ 勾选"启用自动检测踢人"
   - 设置检测间隔: 90-120 秒
   - 设置运行时间: 09:00 - 22:00
4. 点击"💾 保存配置"

### 步骤 2: 验证配置

1. 点击"🔍 立即检测一次"按钮
2. 等待 3-5 秒
3. 查看"📜 踢人日志"卡片,确认检测已执行

### 步骤 3: 查看日志

在"📜 踢人日志"卡片中可以看到:
- 踢人时间
- Team 名称
- 被踢成员邮箱
- 踢出原因
- 执行状态(成功/失败)

## 安全建议

### ✅ 推荐配置

```
启用状态: ✅ 启用
检测间隔: 90-120 秒
运行时间: 09:00-22:00 (北京时间)
```

### ⚠️ 风险提示

1. **请求频率**: 不要设置过短的检测间隔(< 30秒)
2. **运行时间**: 建议设置休息时间,不要 24/7 运行
3. **Token 有效期**: 定期检查 Token 是否过期,及时更新
4. **日志监控**: 定期查看日志,如果出现大量失败,立即停止检测

### 🛡️ 降低风险的措施

系统已内置以下安全措施:

1. **随机间隔**: 在设定范围内随机选择检测间隔
2. **时间限制**: 只在设定的时间段内运行
3. **错误处理**: 遇到 429 (请求过多) 自动等待 5 分钟
4. **浏览器模拟**: 使用 curl_cffi 模拟真实浏览器请求

## 常见问题

### Q1: 为什么我的配置保存后没有生效?

**A**: 检查以下几点:
1. 是否勾选了"启用自动检测踢人"
2. 检测间隔是否 ≥ 30 秒
3. 最小间隔是否 ≤ 最大间隔
4. 查看服务器日志是否有错误

### Q2: 如何知道自动检测是否在运行?

**A**: 
1. 查看"📜 踢人日志",如果有新的日志记录说明在运行
2. 查看服务器控制台,会有检测日志输出
3. 点击"🔍 立即检测一次"测试

### Q3: 会不会误踢合法成员?

**A**: 不会。系统只会踢出以下成员:
- 邮箱不在数据库邀请记录中的成员
- 不会踢出 account-owner (团队所有者)
- 只要是通过系统邀请的成员,都会被保护

### Q4: 如果 Token 过期了怎么办?

**A**: 
1. 在"📋 Teams 列表"中找到对应的 Team
2. 点击"更新 Token"
3. 粘贴新的 Session JSON
4. 自动检测会使用新的 Token

### Q5: 可以暂停自动检测吗?

**A**: 可以。取消勾选"启用自动检测踢人",点击保存即可暂停。

## 技术细节

### 数据库表结构

**auto_kick_config** - 配置表
- `enabled`: 是否启用
- `check_interval_min`: 最小检测间隔(秒)
- `check_interval_max`: 最大检测间隔(秒)
- `start_time`: 开始时间
- `end_time`: 结束时间
- `timezone`: 时区

**kick_logs** - 日志表
- `team_id`: Team ID
- `user_id`: 被踢用户 ID
- `email`: 被踢用户邮箱
- `reason`: 踢出原因
- `success`: 是否成功
- `error_message`: 错误信息
- `created_at`: 创建时间

### API 端点

- `GET /api/admin/auto-kick/config` - 获取配置
- `PUT /api/admin/auto-kick/config` - 更新配置
- `GET /api/admin/auto-kick/logs` - 获取日志
- `POST /api/admin/auto-kick/check-now` - 立即检测

## 更新日志

### v1.0.0 (2025-10-31)
- ✅ 初始版本
- ✅ 支持自动检测踢人
- ✅ 支持配置检测间隔
- ✅ 支持配置运行时间
- ✅ 支持查看踢人日志
- ✅ 支持立即检测功能

## 支持

如有问题,请查看:
1. 服务器控制台日志
2. 踢人日志记录
3. 浏览器控制台 (F12)

